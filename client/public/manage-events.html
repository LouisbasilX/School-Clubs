<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Events | Hillrange Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <style>
    /* Same styles as the user management page */
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap");

    :root {
      --primary: #fbbf24;
      --secondary: #78350f;
      --accent: #f59e0b;
      --light: #fef3c7;
      --dark: #451a03;
      --blue: #1e40af;
      --danger: #dc2626;
      --success: #16a34a;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #fef9e7 0%, #fef3c7 100%);
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }

    .school-font {
    
      font-weight: 900;
      letter-spacing: -0.015em;
    }

    .school-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 50%, var(--secondary) 100%);
    }

    .school-text-gradient {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 50%, var(--secondary) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
 /* Navigation */
    nav {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.95), #fef3c7);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(251, 191, 36, 0.2);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    nav a {
      position: relative;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    nav a:hover::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--accent);
      transform: scaleX(1);
      transform-origin: center;
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--accent);
      transform: scaleX(0);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-toggle {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-radius: 1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, #fef3c7, #fff);
      box-shadow: 0 4px 10px rgba(69, 26, 3, 0.1);
    }

    .dropdown-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(69, 26, 3, 0.2);
      background: linear-gradient(135deg, #fff, #fef3c7);
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 1rem;
      min-width: 260px;
      background: white;
      border-radius: 1.5rem;
      box-shadow: 0 12px 40px rgba(69, 26, 3, 0.2);
      border: 1px solid rgba(251, 191, 36, 0.2);
      backdrop-filter: blur(10px);
      z-index: 100;
      transform: translateY(10px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dropdown-menu.show {
      display: block;
      transform: translateY(0);
      opacity: 1;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1.5rem;
      color: var(--secondary);
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .dropdown-item:hover {
      background: #fef3c7;
      color: var(--dark);
      transform: translateX(5px);
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(69, 26, 3, 0.1);
      border: 1px solid rgba(251, 191, 36, 0.15);
      overflow: hidden;
      position: relative;
      transition: all 0.4s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(69, 26, 3, 0.15);
    }

    /* Event cards specific styles */
    .event-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .event-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 10px 30px rgba(69, 26, 3, 0.15);
      border-color: var(--accent);
    }

    .event-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .event-card:hover .event-image {
      transform: scale(1.05);
    }

    .event-placeholder {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 150px;
    }

    .event-placeholder i {
      font-size: 3rem;
      color: var(--secondary);
      opacity: 0.3;
      animation: pulseIcon 2s ease-in-out infinite;
    }

    /* Modal styles - same as user management */
    /* Improved Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  padding: 1rem;
}

/* Modal Styles - Fixed Version */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  padding: 1rem;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: white;
  border-radius: 1.5rem;
  padding: 2rem;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  transform: translateY(20px);
  transition: transform 0.3s ease;
  box-shadow: 0 20px 50px rgba(69, 26, 3, 0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.modal-overlay.active .modal-content {
  transform: translateY(0);
}

.modal-header {
  padding-bottom: 1.5rem;
  border-bottom: 1px solid rgba(251, 191, 36, 0.2);
  margin-bottom: 1.5rem;
  flex-shrink: 0;
}

.modal-body {
  flex: 1;
  overflow-y: auto;
  padding-right: 0.5rem;
  margin-right: -0.5rem;
}

.modal-footer {
  padding-top: 1.5rem;
  border-top: 1px solid rgba(251, 191, 36, 0.2);
  margin-top: 1.5rem;
  flex-shrink: 0;
}

/* Custom scrollbar */
.modal-body::-webkit-scrollbar {
  width: 6px;
}

.modal-body::-webkit-scrollbar-track {
  background: #fef3c7;
  border-radius: 10px;
}

.modal-body::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 10px;
}
    /* Animations */
    @keyframes pulseIcon {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.2); opacity: 0.5; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .animate-fade-in {
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    .animate-slide-in {
      animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    /* Button styles - same as user management */
    .action-button {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      padding: 0.75rem 1.5rem;
      border-radius: 1rem;
      color: white;
      font-weight: 500;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 10px rgba(251, 191, 36, 0.3);
    }

    .action-button:hover {
      transform: scale(1.05) translateY(-2px);
      box-shadow: 0 6px 15px rgba(251, 191, 36, 0.4);
      background: linear-gradient(135deg, var(--accent), var(--secondary));
    }

    .danger-button {
      background: linear-gradient(135deg, var(--danger), #ef4444);
    }

    .danger-button:hover {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
    }

    .success-button {
      background: linear-gradient(135deg, var(--success), #22c55e);
    }

    .success-button:hover {
      background: linear-gradient(135deg, #22c55e, #15803d);
    }

    /* Form elements */
    textarea, input[type="text"], input[type="password"], input[type="date"], input[type="time"], select {
      border: 1px solid rgba(251, 191, 36, 0.2);
      border-radius: 0.75rem;
      padding: 0.75rem;
      transition: all 0.3s ease;
      background: #fff;
      width: 100%;
    }

    textarea:focus, input[type="text"]:focus, input[type="password"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.2);
    }

    /* Grid layout for events */
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    /* Loading spinner */
    .spinner {
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      background: linear-gradient(135deg, #fef3c7, #fff);
      color: var(--secondary);
      font-size: 0.75rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
      transition: all 0.3s ease;
    }

    .badge:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
    }

    .badge-upcoming {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
    }

    .badge-ongoing {
      background: linear-gradient(135deg, var(--blue), #3b82f6);
      color: white;
    }

    .badge-completed {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
    }

    .badge-cancelled {
      background: linear-gradient(135deg, var(--danger), #ef4444);
      color: white;
    }

    /* Search input container */
    .search-input-container {
      position: relative;
    }

    .search-input-container .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #9CA3AF;
    }

    .search-input-container input {
      padding-left: 40px !important;
    }

    /* Date picker styles */
    .date-time-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Responsive styles */
    @media (max-width: 1000px) {
      nav .hidden {
        display: none;
      }
      
      .sm\:hidden {
        display: flex !important;
      }
      
      .sm\:flex {
        display: none !important;
      }
    }

    @media (max-width: 768px) {
      .events-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
      
      .modal-content {
        width: 95%;
        padding: 1rem;
        margin: 1rem;
      }
      
      .search-filter-container {
        padding: 1rem;
      }
      
      .search-filter-container .grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .date-time-container {
        grid-template-columns: 1fr;
      }
    }

    /* Add these to your existing styles */
.date-time-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  background: rgba(251, 191, 36, 0.05);
  border-radius: 0.75rem;
  padding: 1rem;
}

input[type="date"], input[type="time"] {
  background-color: white;
}

textarea, input, select {
  transition: all 0.2s ease;
  border: 1px solid rgba(251, 191, 36, 0.3);
}

textarea:focus, input:focus, select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.2);
}

.action-button.bg-gray-100 {
  background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
  color: #4b5563;
}

.action-button.bg-gray-100:hover {
  background: linear-gradient(135deg, #e5e7eb, #d1d5db);
}

 /* Responsive navigation - Changed from 640px to 1000px */
    @media (max-width: 1000px) {
      nav .hidden-md {
        display: none;
      }
      
      .mobile-dropdown {
        display: block;
        width: 100%;
        padding: 1rem;
      }
      
    
      .mobile-dropdown-toggle {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        background: linear-gradient(135deg, #fef3c7, #fff);
        box-shadow: 0 4px 10px rgba(69, 26, 3, 0.1);
        width: 100%;
      }
      
      .mobile-dropdown-menu {
        display: none;
        width: 100%;
        background: white;
        border-radius: 0.75rem;
        margin-top: 0.5rem;
        box-shadow: 0 4px 15px rgba(69, 26, 3, 0.1);
      }
      
      .mobile-dropdown-menu.show {
        display: block;
      }
      
      .mobile-dropdown-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: var(--secondary);
        transition: all 0.2s ease;
      }
      
      .mobile-dropdown-item:hover {
        background: #fef3c7;
      }
    }

    @media (min-width: 1001px) {
      .mobile-only {
        display: none !important;
      }
    }

    /* Event Card Specific Styles */
.event-card {
  transition: all 0.3s ease;
  border-radius: 0.75rem;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
  height: 100%;
}

.event-image-container {
  height: 150px;
  overflow: hidden;
  position: relative;
}

.event-content {
  padding: 1.25rem;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

.event-title {
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--dark);
  word-break: break-word;
}

.event-meta {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.event-description {
  font-size: 0.875rem;
  color: #6b7280;
  margin-bottom: 1rem;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  word-break: break-word;
}

.event-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto;
}

/* Mobile-specific styles (500px and below) */
@media (max-width: 500px) {
  .event-card {
    border-radius: 0.5rem;
  }
  
  .event-image-container {
    height: 120px;
  }
  
  .event-content {
    padding: 1rem;
  }
  
  /* Vertical button stack */
  .event-actions {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  /* Make all buttons full width */
  .event-actions .view-attendees-btn,
  .event-action-buttons {
    width: 100%;
  }
  
  .event-action-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  /* Button styles */
  .action-button {
    width: 100%;
    padding: 0.5rem;
    justify-content: center;
    border-radius: 0.5rem;
  }
  
  /* Hide button text, show only icons */
  .action-button .action-text {
    display: none;
  }
  
  .action-button i {
    margin: 0 !important;
  }
  
  /* Special case for view attendees button */
  .view-attendees-btn::after {
    content: " Attendees";
    margin-left: 4px;
    font-size: 0.75rem;
  }
  
  /* Adjust attendee count display */
  .view-attendees-btn i {
    margin-right: 4px !important;
  }
  
  /* Make badge smaller on mobile */
  .badge {
    padding: 0.2rem 0.5rem;
    font-size: 0.7rem;
  }
}
  </style>
</head>
<body class="bg-gray-50 relative overflow-x-hidden">
  <!-- Decorations -->
  <div class="decoration decoration-1"></div>
  <div class="decoration decoration-2"></div>
  <div class="decoration decoration-3"></div>

  <!-- 3D Background Canvas -->
  <canvas id="bgCanvas" class="fixed inset-0 z-0 pointer-events-none"></canvas>

  <!-- Navigation -->
 <nav class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-20">
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center">
            <i class="ti ti-school text-4xl text-yellow-600 mr-3 animate-pulse"></i>
            <span class="text-xl font-bold school-text-gradient school-font"> Admin</span>
          </div>
          <div class="hidden-md sm:ml-8 sm:flex sm:space-x-10">
            <a href="dashboard.html" class="border-transparent text-gray-600 hover:text-gray-800 inline-flex items-center px-2 pt-1 border-b-2 text-base font-medium animate-slide-in">
              <i class="ti ti-layout-dashboard mr-2 text-yellow-600"></i> Dashboard
            </a>
            <a href="manage-users.html" class="border-yellow-500 text-gray-900 inline-flex items-center px-2 pt-1 border-b-2 text-base font-medium animate-slide-in" style="animation-delay: 0.1s;">
              <i class="ti ti-users mr-2 text-yellow-600"></i> Manage Users
            </a>
            <a href="manage-clubs.html" class="border-transparent text-gray-600 hover:text-gray-800 inline-flex items-center px-2 pt-1 border-b-2 text-base font-medium animate-slide-in" style="animation-delay: 0.2s;">
                 Manage Clubs
            </a>
            <a href="manage-events.html" class="border-transparent text-gray-600 hover:text-gray-800 inline-flex items-center px-2 pt-1 border-b-2 text-base font-medium animate-slide-in" style="animation-delay: 0.3s;">
              <i class="ti ti-calendar-event mr-2 text-yellow-600"></i> Manage Events
            </a>
          </div>
        </div>
        <div class="hidden-md sm:ml-6 sm:flex sm:items-center space-x-4">
          <button class="p-2 rounded-full text-gray-400 hover:text-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-all duration-300 animate-pulse">
            <i class="ti ti-bell text-2xl"></i>
          </button>
          <div class="dropdown">
            <button class="dropdown-toggle" id="dropdownToggle">
              <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center relative overflow-hidden">
                <img id="navProfilePicture" class="w-full h-full object-cover hidden" alt="Profile">
                <i class="ti ti-user text-2xl text-yellow-600"></i>
                <div class="absolute inset-0 bg-gradient-to-br from-yellow-50 to-transparent opacity-50"></div>
              </div>
              <span class="ml-3 font-medium text-gray-700 school-font" id="username">Loading...</span>
              <i class="ti ti-chevron-down text-yellow-600 ml-2"></i>
            </button>
            <div class="dropdown-menu" id="dropdownMenu">
              <div class="px-4 py-3 text-sm text-gray-500 border-b border-yellow-50">
                Logged in as <span id="dropdownUsername" class="font-medium text-gray-700"></span>
              </div>
              <a href="profile.html" class="dropdown-item">
                <i class="ti ti-user mr-2"></i> Profile
              </a>
              <a href="settings.html" class="dropdown-item">
                <i class="ti ti-settings mr-2"></i> Settings
              </a>
              <button onclick="logout()" class="dropdown-item w-full text-left">
                <i class="ti ti-logout mr-2"></i> Logout
              </button>
            </div>
          </div>
        </div>
        <!-- Mobile menu button -->
        <div class="mobile-only flex items-center">
          <button type="button" id="mobileMenuButton" class="p-2 rounded-md text-gray-700 hover:text-yellow-600 focus:outline-none">
            <i class="ti ti-menu-2 text-2xl"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Mobile menu -->
    <div class="mobile-only hidden absolute top-20 left-0 right-0 bg-white shadow-lg z-50" id="mobileMenu">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a href="dashboard.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-yellow-600">
          <i class="ti ti-layout-dashboard mr-2"></i> Dashboard
        </a>
        <a href="manage-users.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-900 bg-yellow-50">
          <i class="ti ti-users mr-2"></i> Manage Users
        </a>
        <a href="manage-clubs.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-yellow-600">
          <i class="ti ti-users-group mr-2"></i> Manage Clubs
        </a>
        <a href="manage-events.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-yellow-600">
          <i class="ti ti-calendar-event mr-2"></i> Manage Events
        </a>
        
        <!-- Mobile Profile Dropdown -->
        <div class="mobile-dropdown">
          <button class="mobile-dropdown-toggle" id="mobileDropdownToggle">
            <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center relative overflow-hidden mr-3">
              <img id="mobileNavProfilePicture" class="w-full h-full object-cover hidden" alt="Profile">
              <i class="ti ti-user text-xl text-yellow-600"></i>
            </div>
            <span class="font-medium text-gray-700 school-font" id="mobileUsername">Loading...</span>
            <i class="ti ti-chevron-down text-yellow-600 ml-auto"></i>
          </button>
          <div class="mobile-dropdown-menu" id="mobileDropdownMenu">
            <div class="px-4 py-2 text-sm text-gray-500 border-b border-yellow-50">
              Logged in as <span id="mobileDropdownUsername" class="font-medium text-gray-700"></span>
            </div>
            <a href="profile.html" class="mobile-dropdown-item">
              <i class="ti ti-user mr-2"></i> Profile
            </a>
            <a href="settings.html" class="mobile-dropdown-item">
              <i class="ti ti-settings mr-2"></i> Settings
            </a>
            <button onclick="logout()" class="mobile-dropdown-item w-full text-left">
              <i class="ti ti-logout mr-2"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Page Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12">
      <div>
        <h1 class="text-4xl md:text-5xl font-bold school-text-gradient school-font mb-4 animate-fade-in">
          Event Management
        </h1>
        <p class="text-lg text-gray-600 school-font">Manage all school events and registrations</p>
      </div>
      <a href="create-event.html" class="action-button success-button mt-6 md:mt-0 inline-flex items-center animate-fade-in" style="animation-delay: 0.2s;">
        <i class="ti ti-plus mr-2"></i> Create New Event
      </a>
    </div>

    <!-- Search and Filter -->
  <!-- Remove the status filter dropdown and replace with date range -->
<div class="search-filter-container animate-slide-in">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="search-input-container">
      <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-1">Search Events</label>
      <div class="relative">
        <div class="search-icon">
          <i class="ti ti-search"></i>
        </div>
        <input type="text" id="searchInput" placeholder="Search by event name..." class="w-full py-2 border rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
      </div>
    </div>
    <div>
      <label for="dateFilter" class="block text-sm font-medium text-gray-700 mb-1">Time Period</label>
      <select id="dateFilter" class="w-full py-2 border rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
        <option value="all">All Events</option>
        <option value="upcoming">Upcoming</option>
        <option value="past">Past</option>
        <option value="current">Current</option>
      </select>
    </div>
    <div class="flex items-end">
      <button id="resetFilters" class="action-button w-full">
        <i class="ti ti-filter-off mr-2"></i> Reset Filters
      </button>
    </div>
  </div>
</div>

    <!-- Events Grid -->
    <div class="card p-8 mb-10 animate-slide-in" style="animation-delay: 0.1s;">
      <div id="eventsContainer">
        <div class="events-grid" id="eventsGrid">
          <!-- Events will be loaded here -->
          <div class="animate-pulse text-gray-500">Loading events...</div>
        </div>
      </div>
      <div class="flex justify-between mt-6">
        <button id="eventsPrev" class="action-button disabled">
          <i class="ti ti-chevron-left mr-2"></i> Previous
        </button>
        <div class="text-gray-600" id="pageInfo">Page 1 of 1</div>
        <button id="eventsNext" class="action-button">
          Next <i class="ti ti-chevron-right ml-2"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Event Modal -->
 <!-- Edit Event Modal -->
<div class="modal-overlay" id="editEventModal">
  <div class="modal-content">
    <div class="modal-header flex justify-between items-center">
      <h2 class="text-2xl font-bold text-gray-900 school-font">
        <i class="ti ti-edit text-yellow-600 mr-2"></i> Edit Event
      </h2>
      <button class="close-modal text-gray-400 hover:text-gray-600">
        <i class="ti ti-x text-2xl"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form id="editEventForm" enctype="multipart/form-data">
        <input type="hidden" id="editEventId">
        <div class="space-y-4">
          <div>
            <label for="editEventName" class="block text-sm font-medium text-gray-700 mb-1">Event Name</label>
            <input type="text" id="editEventName" name="name" required class="w-full">
          </div>
          
          <div>
            <label for="editEventDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea id="editEventDescription" name="description" rows="4" required class="w-full"></textarea>
          </div>
          
          <div class="space-y-2">
            <h3 class="text-sm font-medium text-gray-700">Event Timing</h3>
            <div class="date-time-container bg-yellow-50 p-3 rounded-lg">
              <div>
                <label for="editEventStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                <input type="date" id="editEventStartDate" name="startDate" required class="w-full">
              </div>
              <div>
                <label for="editEventStartTime" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                <input type="time" id="editEventStartTime" name="startTime" required class="w-full">
              </div>
            </div>
            
            <div class="date-time-container bg-yellow-50 p-3 rounded-lg">
              <div>
                <label for="editEventEndDate" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                <input type="date" id="editEventEndDate" name="endDate" required class="w-full">
              </div>
              <div>
                <label for="editEventEndTime" class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                <input type="time" id="editEventEndTime" name="endTime" required class="w-full">
              </div>
            </div>
          </div>
          
          <div>
            <label for="editEventLocation" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
            <input type="text" id="editEventLocation" name="location" required class="w-full">
          </div>
          
          <div>
            <label for="editEventImage" class="block text-sm font-medium text-gray-700 mb-1">Update Event Image (optional)</label>
            <input type="file" id="editEventImage" name="image" accept="image/*" class="w-full">
            <div class="mt-2" id="currentEventImagePreview"></div>
          </div>
          
          <div class="grid grid-cols-1 gap-4">
           
            <div>
              <label for="editEventClub" class="block text-sm font-medium text-gray-700 mb-1">Associated Club</label>
              <select id="editEventClub" name="clubId" class="w-full">
                <option value="">No associated club</option>
                <!-- Clubs will be loaded here -->
              </select>
            </div>
              <div>
    <label for="editEventCapacity" class="block text-sm font-medium text-gray-700 mb-1">Capacity</label>
    <input type="number" id="editEventCapacity" name="capacity" min="1" class="w-full">
  </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer flex justify-end space-x-4">
      <button type="button" class="close-modal action-button bg-gray-100 text-gray-700 hover:bg-gray-200">
        Cancel
      </button>
      <button type="submit" form="editEventForm" class="action-button">
        <i class="ti ti-device-floppy mr-2"></i> Save Changes
      </button>
    </div>
  </div>
</div>

  <!-- Delete Event Modal -->
  <div class="modal-overlay" id="deleteEventModal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900 school-font">
          <i class="ti ti-alert-triangle text-yellow-600 mr-2"></i> Confirm Deletion
        </h2>
        <button class="close-modal text-gray-400 hover:text-gray-600">
          <i class="ti ti-x text-2xl"></i>
        </button>
      </div>
      <div class="mb-6">
        <p class="text-gray-700">Are you sure you want to delete the event <span id="deleteEventNameDisplay" class="font-bold"></span>? This action cannot be undone and will remove all associated registrations.</p>
      </div>
      <div class="flex justify-end space-x-4">
        <button type="button" class="close-modal action-button">
          Cancel
        </button>
        <button type="button" id="confirmEventDelete" class="action-button danger-button">
          <i class="ti ti-trash mr-2"></i> Delete Event
        </button>
      </div>
    </div>
  </div>

  <!-- Event Attendees Modal -->
  <div class="modal-overlay" id="eventAttendeesModal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900 school-font">
          <i class="ti ti-users-group text-yellow-600 mr-2"></i> <span id="eventAttendeesTitle"></span>
        </h2>
        <button class="close-modal text-gray-400 hover:text-gray-600">
          <i class="ti ti-x text-2xl"></i>
        </button>
      </div>
      <div class="mb-6">
        <div class="search-input-container mb-4">
          <div class="relative">
            <div class="search-icon">
              <i class="ti ti-search"></i>
            </div>
            <input type="text" id="attendeeSearch" placeholder="Search attendees..." class="w-full py-2 border rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
          </div>
        </div>
        <div class="overflow-y-auto max-h-96">
          <table class="w-full">
            <thead>
              <tr class="bg-yellow-50">
                <th class="text-left p-3">Username</th>
                <th class="text-left p-3">Role</th>
                <th class="text-right p-3">Actions</th>
              </tr>
            </thead>
            <tbody id="eventAttendeesList">
              <!-- Attendees will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="flex justify-between items-center mt-4">
        <div>
          <button id="addAttendeeButton" class="action-button">
            <i class="ti ti-user-plus mr-2"></i> Add Attendees
          </button>
        </div>
        <div class="flex space-x-4">
          <button type="button" class="close-modal action-button">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Attendees Modal -->
  <div class="modal-overlay" id="addAttendeesModal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900 school-font">
          <i class="ti ti-user-plus text-yellow-600 mr-2"></i> Add Attendees to <span id="addAttendeesEventName"></span>
        </h2>
        <button class="close-modal text-gray-400 hover:text-gray-600">
          <i class="ti ti-x text-2xl"></i>
        </button>
      </div>
      <div class="mb-6">
        <div class="search-input-container mb-4">
          <div class="relative">
            <div class="search-icon">
              <i class="ti ti-search"></i>
            </div>
            <input type="text" id="nonAttendeeSearch" placeholder="Search users..." class="w-full py-2 border rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
          </div>
        </div>
        <div class="overflow-y-auto max-h-96">
          <table class="w-full">
            <thead>
              <tr class="bg-yellow-50">
                <th class="text-left p-3">Username</th>
                <th class="text-left p-3">Role</th>
                <th class="text-right p-3">Actions</th>
              </tr>
            </thead>
            <tbody id="nonAttendeesList">
              <!-- Non-attendees will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="flex justify-between items-center mt-4">
        <div>
          <button type="button" class="close-modal action-button">
            <i class="ti ti-arrow-left mr-2"></i> Back to Event
          </button>
        </div>
        <div class="flex space-x-4">
          <button type="button" class="close-modal action-button">
            Done
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-white border-t border-yellow-100 mt-16">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center animate-fade-in">
          <i class="ti ti-school text-3xl text-yellow-600 mr-3 animate-pulse"></i>
          <span class="text-xl font-bold school-text-gradient school-font">Hillrange Admin</span>
        </div>
        <div class="mt-6 md:mt-0">
          <p class="text-center text-base text-gray-500">© 2023 Hillrange School. All rights reserved.</p>
        </div>
        <div class="mt-6 md:mt-0 flex space-x-8">
          <a href="#" class="text-gray-400 hover:text-yellow-600 transition-all duration-300 transform hover:scale-110">
            <i class="ti ti-brand-facebook text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-yellow-600 transition-all duration-300 transform hover:scale-110">
            <i class="ti ti-brand-twitter text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-yellow-600 transition-all duration-300 transform hover:scale-110">
            <i class="ti ti-brand-instagram text-xl"></i>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    const user = JSON.parse(localStorage.getItem('loggedInUser'))?.user;
    if (!user) {
      window.location.href = '/login.html';
    }
    if(user.role === 'user') window.location.href = '/access-denied.html';

    // Global variables
    let currentUser = null;
    let eventsData = [];
    let filteredEvents = [];
    let currentPage = 0;
    const eventsPerPage = 9;
    let currentEventAttendees = [];
    let allUsers = [];
    let allClubs = [];

    // Initialize 3D Background
    function initBackground() {
      const canvas = document.getElementById('bgCanvas');
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);

      const geometry = new THREE.BufferGeometry();
      const vertices = [];
      const colors = [];
      const sizes = [];
      const palette = [0xfbbf24, 0xf59e0b, 0x78350f, 0x1e40af];

      for (let i = 0; i < 600; i++) {
        vertices.push(
          Math.random() * 2000 - 1000,
          Math.random() * 2000 - 1000,
          Math.random() * 2000 - 1000
        );
        const color = new THREE.Color(palette[Math.floor(Math.random() * palette.length)]);
        colors.push(color.r, color.g, color.b);
        sizes.push(Math.random() * 5 + 2);
      }

      geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
      geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

      const material = new THREE.PointsMaterial({
        size: 5,
        vertexColors: true,
        transparent: true,
        opacity: 0.3,
      });

      const particles = new THREE.Points(geometry, material);
      scene.add(particles);
      camera.position.z = 1000;

      function animate() {
        requestAnimationFrame(animate);
        particles.rotation.y += 0.001;
        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    // Load user data
    async function loadUserData() {
      try {
        document.getElementById('username').textContent = user.username;
        document.getElementById('dropdownUsername').textContent = user.username;
        document.getElementById('mobileUsername').textContent = user.username;
        document.getElementById('mobileDropdownUsername').textContent = user.username;
        currentUser = user;
        await loadAllEvents();
        await loadAllUsers();
        await loadAllClubs();
      } catch (err) {
        console.error('Failed to load user data:', err);
        showError('Failed to load user data. Please try again later.');
      }
    }

    // Load all events
    async function loadAllEvents() {
      try {
        const response = await fetch('/api/events');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        eventsData = await response.json();
        filteredEvents = [...eventsData];
        renderEventsGrid();
        updatePagination();
      } catch (err) {
        console.error('Failed to load events:', err);
        document.getElementById('eventsGrid').innerHTML = `
          <div class="col-span-full text-center py-8 text-red-500">
            Failed to load events. Please try again.
          </div>
        `;
      }
    }

    // Load all users
    async function loadAllUsers() {
      try {
        const response = await fetch('/api/users');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        allUsers = await response.json();
      } catch (err) {
        console.error('Failed to load users:', err);
      }
    }

    // Load all clubs
    async function loadAllClubs() {
      try {
        const response = await fetch('/api/clubs');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        allClubs = await response.json();
        
        // Populate club dropdowns
        const clubDropdowns = [
          document.getElementById('editEventClub')
        ];
        
        clubDropdowns.forEach(dropdown => {
          if (dropdown) {
            dropdown.innerHTML = '<option value="">No associated club</option>' + 
              allClubs.map(club => `<option value="${club.id}">${club.name}</option>`).join('');
          }
        });
      } catch (err) {
        console.error('Failed to load clubs:', err);
      }
    }

    // Render events grid
  function renderEventsGrid() {
  const container = document.getElementById('eventsGrid');
  container.innerHTML = '';

  if (filteredEvents.length === 0) {
    container.innerHTML = `
      <div class="col-span-full text-center py-8 text-gray-500">
        No events found matching your criteria.
      </div>
    `;
    return;
  }

  const start = currentPage * eventsPerPage;
  const end = start + eventsPerPage;
  const paginatedEvents = filteredEvents.slice(start, end);

  paginatedEvents.forEach((event, i) => {
    const eventElement = document.createElement('div');
    eventElement.className = 'event-card bg-white overflow-hidden shadow rounded-lg border border-gray-200 animate-slide-in';
    eventElement.style.animationDelay = `${i * 0.1}s`;
    
    // Format dates and times
    const startDate = new Date(event.startDate);
    const endDate = new Date(event.endDate);
    const now = new Date();
    
    // Determine time status based on current date
    let timeStatus = '';
    if (startDate > now) {
      timeStatus = 'Upcoming';
    } else if (endDate < now) {
      timeStatus = 'Past';
    } else {
      timeStatus = 'Ongoing';
    }
    
    // Format date display
    const isSameDay = startDate.toDateString() === endDate.toDateString();
    const formattedDate = isSameDay 
      ? startDate.toLocaleDateString('en-US', { 
          weekday: 'short', 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric'
        })
      : `${startDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric'
        })} - ${endDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: startDate.getFullYear() === endDate.getFullYear() ? undefined : 'numeric'
        })}`;
    
    // Format time display
    const formattedTime = isSameDay
      ? `${startDate.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit'
        })} - ${endDate.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit'
        })}`
      : `Starts: ${startDate.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit'
        })}`;
    
    // Find associated club if exists
    const associatedClub = event.club ? allClubs.find(c => c.id === event.club) : null;
    
    eventElement.innerHTML = `
      <div class="event-image-container ${!event.image || event.image === 'null' ? 'event-placeholder' : ''}">
        ${event.image && event.image !== 'null'
          ? `<img src="${event.image}" alt="${event.title}" class="event-image">`
          : `<i class="ti ti-calendar-event"></i>`}
      </div>
      <div class="p-6">
        <h3 class="text-lg font-medium text-gray-900 school-font mb-2">${event.title}</h3>
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center text-sm text-gray-500">
            <i class="ti ti-calendar mr-1"></i>
            <span>${formattedDate}</span>
          </div>
          <span class="badge ${timeStatus === 'Upcoming' ? 'badge-upcoming' : timeStatus === 'Ongoing' ? 'badge-ongoing' : 'badge-completed'}">
            ${timeStatus}
          </span>
        </div>
        <div class="flex items-center text-sm text-gray-500 mb-2">
          <i class="ti ti-clock mr-1"></i>
          <span>${formattedTime}</span>
        </div>
        <p class="text-sm text-gray-600 mb-2"><i class="ti ti-map-pin mr-1"></i> ${event.location}</p>
        ${associatedClub ? `<p class="text-sm text-gray-600 mb-4"><i class="ti ti-users-group mr-1"></i> ${associatedClub.name}</p>` : ''}
        <p class="text-sm text-gray-600 mb-4 line-clamp-2">${event.description || 'No description available'}</p>
       <div class="event-actions">
  <button id="view${event.id}Attendees" onclick="viewEventAttendees('${event.id}', '${event.title}')" 
          class="action-button view-attendees-btn">
    <i class="ti ti-users"></i>
    <span class="attendee-count">${event.attendees?.length || 0}</span>
  </button>
  <div class="event-action-buttons">
    <button onclick="editEvent('${event.id}')" class="action-button" title="Edit Event">
      <i class="ti ti-edit"></i>
      <span class="action-text">Edit</span>
    </button>
    <button onclick="showDeleteEventModal('${event.id}', '${event.title}')" 
            class="action-button danger-button" title="Delete Event">
      <i class="ti ti-trash"></i>
      <span class="action-text">Delete</span>
    </button>
  </div>
</div>
      </div>
    `;
    container.appendChild(eventElement);
  });
}
    // Update pagination controls
    function updatePagination() {
      const totalPages = Math.ceil(filteredEvents.length / eventsPerPage);
      document.getElementById('pageInfo').textContent = `Page ${currentPage + 1} of ${totalPages}`;
      document.getElementById('eventsPrev').classList.toggle('disabled', currentPage === 0);
      document.getElementById('eventsNext').classList.toggle('disabled', currentPage + 1 >= totalPages);
    }

    // Filter events based on search and status
function filterEvents() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const dateFilter = document.getElementById('dateFilter').value;
  const now = new Date();

  filteredEvents = eventsData.filter(event => {
    // Search filter
    const matchesSearch = event.title.toLowerCase().includes(searchTerm) || 
                         event.description.toLowerCase().includes(searchTerm);
    
    // Date filter logic
    const startDate = new Date(event.startDate);
    const endDate = new Date(event.endDate);
    let matchesDate = true;
    
    switch(dateFilter) {
      case 'upcoming':
        matchesDate = startDate > now;
        break;
      case 'past':
        matchesDate = endDate < now;
        break;
      case 'current':
        matchesDate = startDate <= now && endDate >= now;
        break;
      case 'all':
      default:
        matchesDate = true;
    }
    
    return matchesSearch && matchesDate;
  });

  currentPage = 0;
  renderEventsGrid();
  updatePagination();
}

    // Show edit event modal
function editEvent(eventId) {
  const event = eventsData.find(e => e.id === eventId);
  if (!event) return;

  document.getElementById('editEventId').value = event.id;
  document.getElementById('editEventName').value = event.title;
  document.getElementById('editEventDescription').value = event.description || '';
  
  // Format start date/time for input
  const startDate = new Date(event.startDate);
  const formattedStartDate = startDate.toISOString().split('T')[0];
  const formattedStartTime = startDate.toTimeString().substring(0, 5);
  document.getElementById('editEventStartDate').value = formattedStartDate;
  document.getElementById('editEventStartTime').value = formattedStartTime;
  
  // Format end date/time for input
  const endDate = new Date(event.endDate);
  const formattedEndDate = endDate.toISOString().split('T')[0];
  const formattedEndTime = endDate.toTimeString().substring(0, 5);
  document.getElementById('editEventEndDate').value = formattedEndDate;
  document.getElementById('editEventEndTime').value = formattedEndTime;
  
  document.getElementById('editEventLocation').value = event.location;
  document.getElementById('editEventCapacity').value = event.capacity || 20;

  
  // Set associated club if exists
  if (event.club) {
    document.getElementById('editEventClub').value = event.club;
  }
  
  // Display current image if exists
  const previewContainer = document.getElementById('currentEventImagePreview');
  previewContainer.innerHTML = '';
  if (event.image && event.image !== 'null') {
    previewContainer.innerHTML = `
      <p class="text-sm text-gray-500 mb-2">Current Image:</p>
      <img src="${event.image}" alt="${event.title}" class="w-32 h-32 object-cover rounded-lg">
    `;
  }
  
  document.getElementById('editEventModal').classList.add('active');
}
    // Show delete confirmation modal
    function showDeleteEventModal(eventId, eventName) {
      document.getElementById('deleteEventNameDisplay').textContent = eventName;
      document.getElementById('confirmEventDelete').dataset.eventId = eventId;
      document.getElementById('deleteEventModal').classList.add('active');
    }

    // View event attendees
    function viewEventAttendees(eventId, eventName) {
      const event = eventsData.find(e => e.id === eventId);
      if (!event) return;

      document.getElementById('eventAttendeesTitle').textContent = `${eventName} Attendees`;
      document.getElementById('eventAttendeesModal').dataset.eventId = eventId;
      
      // Get attendees data
      currentEventAttendees = allUsers.filter(user => user.events?.includes(eventId));
      renderEventAttendees(currentEventAttendees);
      
      document.getElementById('eventAttendeesModal').classList.add('active');
    }

    // Render event attendees
    function renderEventAttendees(attendees) {
      const container = document.getElementById('eventAttendeesList');
      container.innerHTML = '';

      if (attendees.length === 0) {
        container.innerHTML = `
          <tr>
            <td colspan="3" class="text-center py-4 text-gray-500">No attendees for this event yet</td>
          </tr>
        `;
        return;
      }

      attendees.forEach(attendee => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-100 hover:bg-yellow-50';
        row.innerHTML = `
          <td class="p-3">${attendee.username}</td>
          <td class="p-3">
            <span class="badge ${attendee.role === 'user' ? 'badge-user' : 'badge-admin'}">
              ${attendee.role === 'user' ? 'User' : 'Admin'}
            </span>
          </td>
          <td class="p-3 text-right">
            <button onclick="removeAttendeeFromEvent('${attendee.username}', '${document.getElementById('eventAttendeesModal').dataset.eventId}')" class="action-button danger-button" title="Remove from Event">
              <i class="ti ti-user-minus"></i>
            </button>
          </td>
        `;
        container.appendChild(row);
      });
    }

    // Close all modals
    function closeAllModals() {
      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.classList.remove('active');
      });
    }

    // Update event
    async function updateEvent(event) {
  event.preventDefault();
  console.log(document.getElementById('editEventModal'))
  const button = document.getElementById('editEventModal').querySelector('button[type="submit"]');
  const originalText = button.innerHTML;
  button.innerHTML = '<i class="ti ti-loader spinner mr-2"></i> Saving...';
  button.disabled = true;

  try {
    const formData = new FormData(event.target);
    const eventId = document.getElementById('editEventId').value;
    const eventName = formData.get('name');
    
    // Validate required fields
    if (!eventName || !formData.get('description') || 
        !formData.get('startDate') || !formData.get('startTime') ||
        !formData.get('endDate') || !formData.get('endTime') ||
        !formData.get('location')) {
      throw new Error('Please fill in all required fields');
    }

    // Combine date and time into ISO strings
    const startDateTime = `${formData.get('startDate')}T${formData.get('startTime')}:00`;
    const endDateTime = `${formData.get('endDate')}T${formData.get('endTime')}:00`;
    
    // Add the combined datetime strings to formData
    formData.append('startDate', startDateTime);
    formData.append('endDate', endDateTime);

    const response = await fetch(`/api/events/${eventId}`, {
      method: 'PUT',
      body: formData,
      headers: {
        'X-User-Name': user.username,
        'X-User-Role': user.role
      }
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error || 'Failed to update event');
    }

    // Update local data
    const updatedEvent = await response.json();
    const eventIndex = eventsData.findIndex(e => e.id === eventId);
    
    if (eventIndex !== -1) {
      eventsData[eventIndex] = updatedEvent;
    }

    // Record activity
    await fetch(`/api/users/${encodeURIComponent(user.username)}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        recentActivity: {
          header: "Event Updated",
          message: `Updated event: ${eventName}`,
          icon: "ti-edit"
        }
      })
    });

    filterEvents();
    closeAllModals();
    
    showNotification(`Event "${eventName}" updated successfully!`, 'success');
  } catch (err) {
    console.error('Failed to update event:', err);
    showNotification(err.message || 'Failed to update event. Please try again.', 'error');
  } finally {
    button.innerHTML = originalText;
    button.disabled = false;
  }
}

    // Delete event
    async function deleteEvent(eventId) {
      const button = document.getElementById('confirmEventDelete');
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="ti ti-loader spinner mr-2"></i> Deleting...';
      button.disabled = true;
      const eventName = eventsData.find(e => e.id === eventId).name;

      try {
        // First remove all attendees from the event
        const event = eventsData.find(e => e.id === eventId);
        if (event && event.attendees && event.attendees.length > 0) {
          // Create an array of promises for removing attendees
          const removePromises = event.attendees.map(username => 
            removeAttendeeFromEvent(username, eventId, false)
          );
          
          // Wait for all attendees to be removed
          await Promise.all(removePromises);
        }

        // Then delete the event
        const response = await fetch(`/api/events/${eventId}`, {
          method: 'DELETE',
        });

        // Record activity for the admin who deleted the event
        await fetch(`/api/users/${encodeURIComponent(user.username)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recentActivity: {
              header: "Event Deleted",
              message: `Deleted event: ${eventName}`,
              icon: "ti-trash"
            }
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Failed to delete event');
        }

        // Update local data
        eventsData = eventsData.filter(e => e.id !== eventId);
        filterEvents();
        closeAllModals();
        
        showNotification('Event deleted successfully!', 'success');
      } catch (err) {
        console.error('Failed to delete event:', err);
        showNotification(err.message || 'Failed to delete event. Please try again.', 'error');
      } finally {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    // Remove attendee from event
    async function removeAttendeeFromEvent(username, eventId, showNotificationFlag = true) {
      const event = eventsData.find(e => e.id === eventId);
      try {
        const [removeResponse, updateResponse] = await Promise.all([
          fetch(`/api/events/${eventId}/remove-attendee`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username }),
          }),
          fetch(`/api/users/${encodeURIComponent(username)}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ leaveEventId: eventId }),
          })
        ]);

        // Record activity
        await fetch(`/api/users/${encodeURIComponent(user.username)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recentActivity: {
              header: "Removed User from Event",
              message: `You removed ${username} from ${event.title} event`,
              icon: "ti-calendar-event"
            }
          })
        });

        if (!removeResponse.ok || !updateResponse.ok) {
          const error = await removeResponse.json();
          throw new Error(error.error || 'Failed to remove attendee');
        }

        // Update local data
        const userIndex = allUsers.findIndex(u => u.username === username);
        if (userIndex !== -1) {
          allUsers[userIndex].events = allUsers[userIndex].events?.filter(id => id !== eventId);
        }

        // Update the event's attendees list
        const eventIndex = eventsData.findIndex(e => e.id === eventId);
        if (eventIndex !== -1) {
          eventsData[eventIndex].attendees = eventsData[eventIndex].attendees?.filter(u => u !== username);
        }

        // Update UI
        currentEventAttendees = currentEventAttendees.filter(a => a.username !== username);
        renderEventAttendees(currentEventAttendees);
        
        const viewAttendeeBtn = document.getElementById(`view${eventId}Attendees`);
        if (viewAttendeeBtn) {
          viewAttendeeBtn.innerHTML = `<i class="ti ti-users mr-1"></i> ${currentEventAttendees.length}`;
        }

        // Show success notification if requested
        if (showNotificationFlag) {
          showNotification(`${username} removed from event!`, 'success');
        }
      } catch (err) {
        console.error('Failed to remove attendee:', err);
        showNotification(err.message || 'Failed to remove attendee. Please try again.', 'error');
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      // Create notification container if it doesn't exist
      let notificationContainer = document.getElementById('notification-container');
      if (!notificationContainer) {
        notificationContainer = document.createElement('div');
        notificationContainer.id = 'notification-container';
        notificationContainer.className = 'fixed top-4 right-4 z-[1000] space-y-3 w-full max-w-xs';
        document.body.appendChild(notificationContainer);
      }

      // Create notification element
      const notification = document.createElement('div');
      const icon = type === 'success' ? 'ti-circle-check' : 
                  type === 'error' ? 'ti-alert-triangle' : 
                  type === 'warning' ? 'ti-alert-circle' : 'ti-info-circle';
      
      const bgColor = type === 'success' ? 'bg-green-500' : 
                     type === 'error' ? 'bg-red-500' : 
                     type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';

      notification.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-start animate-fade-in transform transition-all duration-300`;
      notification.innerHTML = `
        <i class="ti ${icon} text-xl mr-3 mt-0.5"></i>
        <div class="flex-1">
          <p class="text-sm font-medium">${message}</p>
        </div>
        <button class="ml-2 text-white hover:text-white/80 focus:outline-none">
          <i class="ti ti-x"></i>
        </button>
      `;

      // Add to container
      notificationContainer.appendChild(notification);

      // Auto-remove after 5 seconds
      const autoRemove = setTimeout(() => {
        notification.classList.add('opacity-0', 'translate-x-10');
        setTimeout(() => notification.remove(), 300);
      }, 5000);

      // Manual close
      notification.querySelector('button').addEventListener('click', () => {
        clearTimeout(autoRemove);
        notification.classList.add('opacity-0', 'translate-x-10');
        setTimeout(() => notification.remove(), 300);
      });
    }

    // Show error message
    function showError(message) {
      const mainContent = document.querySelector('.max-w-7xl.mx-auto');
      mainContent.innerHTML = `
        <div class="text-center py-20 animate-fade-in">
          <i class="ti ti-alert-triangle text-6xl text-red-500 mb-6"></i>
          <h2 class="text-3xl font-bold text-gray-900 mb-4 school-font">Access Denied</h2>
          <p class="text-gray-600 mb-8">${message}</p>
          <button onclick="window.location.href='dashboard.html'" class="school-gradient inline-flex items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-lg font-medium text-white hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
            <i class="ti ti-arrow-left mr-2"></i> Back to Dashboard
          </button>
        </div>
      `;
    }

    // Logout function
    function logout() {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'login.html';
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      initBackground();

      // Dropdown functionality
      const toggle = document.getElementById('dropdownToggle');
      const menu = document.getElementById('dropdownMenu');
      toggle.addEventListener('click', () => {
        menu.classList.toggle('show');
        gsap.to(menu, {
          opacity: menu.classList.contains('show') ? 1 : 0,
          y: menu.classList.contains('show') ? 0 : 10,
          duration: 0.3,
          ease: 'power2.out',
        });
      });

      document.addEventListener('click', (e) => {
        if (!toggle.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove('show');
          gsap.to(menu, { opacity: 0, y: 10, duration: 0.3, ease: 'power2.out' });
        }
      });

      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobileMenuButton');
      const mobileMenu = document.getElementById('mobileMenu');
      mobileMenuButton.addEventListener('click', () => {
        const isExpanded = mobileMenu.classList.toggle('hidden');
        mobileMenuButton.innerHTML = isExpanded 
          ? '<i class="ti ti-menu-2 text-2xl"></i>' 
          : '<i class="ti ti-x text-2xl"></i>';
      });

      // Mobile dropdown toggle
      const mobileDropdownToggle = document.getElementById('mobileDropdownToggle');
      const mobileDropdownMenu = document.getElementById('mobileDropdownMenu');
      if (mobileDropdownToggle) {
        mobileDropdownToggle.addEventListener('click', () => {
          mobileDropdownMenu.classList.toggle('show');
        });
      }

      // Modal close buttons
      document.querySelectorAll('.close-modal').forEach(button => {
        button.addEventListener('click', closeAllModals);
      });

      // Form submissions
      document.getElementById('editEventForm').addEventListener('submit', updateEvent);

      // Delete confirmation
      document.getElementById('confirmEventDelete').addEventListener('click', () => {
        const eventId = document.getElementById('confirmEventDelete').dataset.eventId;
        deleteEvent(eventId);
      });

      // Search and filter
      document.getElementById('searchInput').addEventListener('input', filterEvents);
      document.getElementById('dateFilter').addEventListener('change', filterEvents);
  document.getElementById('resetFilters').addEventListener('click', () => {
  document.getElementById('searchInput').value = '';
  document.getElementById('dateFilter').value = 'all';
  filterEvents();
});

      // Pagination
      document.getElementById('eventsPrev').addEventListener('click', () => {
        if (currentPage > 0) {
          currentPage--;
          renderEventsGrid();
          updatePagination();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      document.getElementById('eventsNext').addEventListener('click', () => {
        if ((currentPage + 1) * eventsPerPage < filteredEvents.length) {
          currentPage++;
          renderEventsGrid();
          updatePagination();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      // Add attendees button
      document.getElementById('addAttendeeButton').addEventListener('click', () => {
        const eventId = document.getElementById('eventAttendeesModal').dataset.eventId;
        const eventName = document.getElementById('eventAttendeesTitle').textContent.replace(' Attendees', '');
        
        document.getElementById('addAttendeesEventName').textContent = eventName;
        document.getElementById('addAttendeesModal').dataset.eventId = eventId;
        
        // Show non-attendees
        const nonAttendees = allUsers.filter(user => !user.events?.includes(eventId));
        renderNonAttendees(nonAttendees);
        
        closeAllModals();
        document.getElementById('addAttendeesModal').classList.add('active');
      });

      // GSAP animations
      gsap.from('nav', { y: -100, opacity: 0, duration: 1, ease: 'power3.out' });
      gsap.from('.search-filter-container', { y: 20, opacity: 0, duration: 0.8, delay: 0.2, ease: 'power3.out' });
      gsap.from('.card', { y: 20, opacity: 0, duration: 0.8, delay: 0.4, ease: 'power3.out' });

      loadUserData();
    });

    // Render non-attendees for adding to event
    function renderNonAttendees(users) {
      const container = document.getElementById('nonAttendeesList');
      container.innerHTML = '';

      if (users.length === 0) {
        container.innerHTML = `
          <tr>
            <td colspan="3" class="text-center py-4 text-gray-500">All users are already attending this event</td>
          </tr>
        `;
        return;
      }

      users.forEach(user => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-100 hover:bg-yellow-50';
        row.innerHTML = `
          <td class="p-3">${user.username}</td>
          <td class="p-3">
            <span class="badge ${user.role === 'admin' ? 'badge-admin' : 'badge-user'}">
              ${user.role === 'admin' ? 'Admin' : 'User'}
            </span>
          </td>
          <td class="p-3 text-right">
            <button onclick="addAttendeeToEvent('${user.username}', '${document.getElementById('addAttendeesModal').dataset.eventId}')" class="action-button success-button" title="Add to Event">
              <i class="ti ti-user-plus"></i>
            </button>
          </td>
        `;
        container.appendChild(row);
      });
    }

    // Add attendee to event
    async function addAttendeeToEvent(username, eventId) {
      const event = eventsData.find(e => e.id === eventId);
      console.log(event)
      try {
        const [addResponse, updateResponse] = await Promise.all([
          fetch(`/api/events/${eventId}/add-attendee`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username }),
          }),
          fetch(`/api/users/${encodeURIComponent(username)}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ joinEventId: eventId }),
          })
        ]);

        // Record activity
        await fetch(`/api/users/${encodeURIComponent(user.username)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            recentActivity: {
              header: "Added User to Event",
              message: `You added ${username} to ${event.title} event`,
              icon: "ti-calendar-event"
            }
          })
        });

        if (!addResponse.ok || !updateResponse.ok) {
          const error = await addResponse.json();
          throw new Error(error.error || 'Failed to add attendee');
        }

        // Update local data
        const userIndex = allUsers.findIndex(u => u.username === username);
        if (userIndex !== -1) {
          if (!allUsers[userIndex].events) {
            allUsers[userIndex].events = [];
          }
          allUsers[userIndex].events.push(eventId);
        }

        // Update the event's attendees list
        const eventIndex = eventsData.findIndex(e => e.id === eventId);
        if (eventIndex !== -1) {
          if (!eventsData[eventIndex].attendees) {
            eventsData[eventIndex].attendees = [];
          }
          eventsData[eventIndex].attendees.push(username);
        }

        // Update the non-attendees list
        const nonAttendees = allUsers.filter(user => !user.events?.includes(eventId));
        renderNonAttendees(nonAttendees);
        
        const viewAttendeeBtn = document.getElementById(`view${eventId}Attendees`);
        if (viewAttendeeBtn) {
          viewAttendeeBtn.innerHTML = `<i class="ti ti-users mr-1"></i> ${eventsData[eventIndex]?.attendees?.length || 0}`;
        }

        showNotification(`${username} added to event!`, 'success');
      } catch (err) {
        console.error('Failed to add attendee:', err);
        showNotification(err.message || 'Failed to add attendee. Please try again.', 'error');
      }
    }
  </script>
</body>
</html>